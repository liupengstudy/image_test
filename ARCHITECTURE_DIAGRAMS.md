# 系统架构图

本文档包含Dream Machine项目的系统架构图和流程图。

## 系统架构图

```
+------------------+        +------------------+        +------------------+
|                  |        |                  |        |                  |
|    客户端浏览器   +------->+   前端应用服务器  +------->+   后端API服务器   |
|                  |        |                  |        |                  |
+------------------+        +------------------+        +--------+---------+
                                                                 |
                                                                 |
                                                                 v
                            +------------------+        +--------+---------+
                            |                  |        |                  |
                            |   阿里云QWQ模型   |<-------+   图像生成服务    |
                            |                  |        |                  |
                            +------------------+        +--------+---------+
                                                                 |
                                                                 |
                                                                 v
                                                        +--------+---------+
                                                        |                  |
                                                        | 阿里云通义万相模型 |
                                                        |                  |
                                                        +------------------+
```

## 前端组件架构图

```
+---------------------+
|                     |
|     CreatorPage     |
|                     |
+---+-------+-------+-+
    |       |       |
    |       |       |
    v       v       v
+---+---+ +-+-----+ +--+-----+
|       | |       | |        |
|项目列表| |创作区域| |头脑风暴|
|       | |       | |        |
+-------+ +---+---+ +--------+
              |
              |
              v
    +---------+----------+
    |         |          |
    v         v          v
+---+---+ +---+----+ +---+---+
|       | |        | |       |
|消息历史| |图像展示 | |输入区域|
|       | |        | |       |
+-------+ +--------+ +---+---+
                         |
                         |
                         v
               +---------+---------+
               |         |         |
               v         v         v
          +----+--+  +---+---+ +---+---+
          |       |  |       | |       |
          |上传图像|  |引用图像| |提交按钮|
          |       |  |       | |       |
          +-------+  +-------+ +-------+
```

## 浮动UI组件结构

```
+------------------------------------+
|                                    |
|   浮动标题栏 (固定在顶部)            |
|                                    |
+------------------------------------+

                ...

+------------------------------------+
|                                    |
|   内容区域 (图像和消息展示)           |
|                                    |
+------------------------------------+

                ...

+------------------------------------+
|                                    |
|   浮动输入框 (固定在底部)            |
|                                    |
+------------------------------------+
```

## 图像生成流程图

```
  客户端                                        服务器
    |                                            |
    |--- 1. 发送提示词和可能的参考图像 ----------->|
    |                                            |
    |                                            |--- 2. 调用QWQ模型优化提示词 ----> QWQ模型
    |                                            |                                    |
    |                                            |<--- 3. 返回优化后的提示词 ----------+
    |                                            |
    |                                            |--- 4. 调用通义万相生成图像 -----> 通义万相
    |                                            |                                    |
    |                                            |<--- 5. 返回生成的图像 ------------+
    |                                            |
    |                                            |--- 6. 保存生成历史
    |                                            |
    |<-- 7. 返回生成的图像和优化后的提示词 -------|
    |                                            |
    |--- 8. 显示生成结果 ------------------+     |
    |                                      |     |
    |<-------------------------------------+     |
```

## 头脑风暴功能流程图

```
  用户                                       系统
    |                                         |
    |--- 1. 点击头脑风暴按钮 ---------------->|
    |                                         |
    |<-- 2. 显示头脑风暴面板（分类和示例） ----|
    |                                         |
    |--- 3. 浏览并选择提示词示例 ------------>|
    |                                         |
    |<-- 4. 将选中的提示词填入输入框 ----------|
    |                                         |
    |<-- 5. 关闭头脑风暴面板 ------------------|
    |                                         |
    |--- 6. 可选：修改提示词 ----------------->|
    |                                         |
    |--- 7. 提交生成请求 --------------------->|
    |                                         |
    |<-- 8. 返回生成结果 ----------------------|
```

## 参考图像功能流程图

```
  用户                                       系统
    |                                         |
    |--- 1. 点击上传图像按钮 ----------------->|
    |                                         |
    |<-- 2. 打开文件选择器 --------------------|
    |                                         |
    |--- 3. 选择图像文件 --------------------->|
    |                                         |
    |<-- 4. 在上传预览区显示图像 --------------|
    |                                         |
    |--- 5. 输入提示词并提交 ----------------->|
    |                                         |
    |<-- 6. 生成结合参考图像的结果 ------------|
    |                                         |
    |                                         |
    |--- 7. 点击"引用"已生成的图像 ----------->|
    |                                         |
    |<-- 8. 将图像添加到引用区 ----------------|
    |                                         |
    |--- 9. 提交新的生成请求 ----------------->|
    |                                         |
    |<-- 10. 返回考虑引用图像的新结果 ----------|
```

## 项目管理流程图

```
  用户                                       系统
    |                                         |
    |--- 1. 点击切换到项目列表 ---------------->|
    |                                         |
    |<-- 2. 显示项目列表页面 -------------------|
    |                                         |
    |--- 3a. 选择现有项目 -------------------->|
    |    或                                   |
    |--- 3b. 点击创建新项目 ------------------>|
    |                                         |
    |<-- 4. 加载选中项目或初始化新项目 ----------|
    |                                         |
    |<-- 5. 切换回创作页面 ---------------------|
    |                                         |
    |<-- 6. 显示项目标题和历史 -----------------|
```

## 数据模型关系图

```
    +-------+      +-------+      +-----------+
    |       |      |       |      |           |
    | User  +------+ Project+------+ Prompt   |
    |       |      |       |      | History   |
    +---+---+      +---+---+      +-----+-----+
        |              |                |
        |              |                |
        |              |                |
        |              v                v
        |          +---+----------------+--+
        +----------+                       |
                   |        Image          |
                   |                       |
                   +-----------------------+
```

## 后端层次结构图

```
+-------------+
|             |
|   路由层     |
|             |
+------+------+
       |
       v
+------+------+
|             |
|   控制器层   |
|             |
+------+------+
       |
       v
+------+------+     +-------------+
|             |     |             |
|   服务层     +---->+   模型层     |
|             |     |             |
+------+------+     +-------------+
       |
       v
+------+------+
|             |
|   工具层     |
|             |
+-------------+
```

## 错误处理流程图

```
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|   服务层     +---->+   控制器层   +---->+ 错误处理中间件|
|  抛出错误    |     |  捕获错误    |     | 格式化错误   |
|             |     |             |     |             |
+-------------+     +-------------+     +------+------+
                                               |
                                               v
                                        +------+------+
                                        |             |
                                        |   客户端     |
                                        | 展示错误信息  |
                                        |             |
                                        +-------------+
```

## 部署架构图

```
                    +-------------+
                    |             |
                    |   用户浏览器  |
                    |             |
                    +------+------+
                           |
                           v
+-------------+     +------+------+
|             |     |             |
| 静态资源CDN  <-----+  前端应用    |
|             |     |             |
+-------------+     +------+------+
                           |
                           v
+-------------+     +------+------+     +-------------+
|             |     |             |     |             |
| 监控和告警   <-----+  后端API    +----->+  日志系统   |
|             |     |             |     |             |
+-------------+     +------+------+     +-------------+
                           |
                           v
                    +------+------+
                    |             |
                    | MongoDB数据库|
                    |             |
                    +-------------+
```

## 技术栈图

```
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|    React    |     |  TypeScript |     | Tailwind CSS|
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
       |                  |                   |
       +------------------+-------------------+
                          |
                          v
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|   Node.js   |     |   Express   |     |  MongoDB    |
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
       |                  |                   |
       +------------------+-------------------+
                          |
                          v
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|    Jest     |     |    Axios    |     |  OpenAI SDK |
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
```

注意：这些图表使用ASCII艺术表示，在实际文档中可以使用专业的图表工具（如Draw.io、Lucidchart等）创建更美观的图表。 