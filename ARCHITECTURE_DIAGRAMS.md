# 系统架构图

本文档包含Dream Machine项目的系统架构图和流程图。

## 系统架构图

```
+------------------+        +------------------+        +------------------+
|                  |        |                  |        |                  |
|    客户端浏览器   +------->+   前端应用服务器  +------->+   后端API服务器   |
|                  |        |                  |        |                  |
+------------------+        +------------------+        +--------+---------+
                                                                 |
                                                                 |
                                                                 v
                            +------------------+        +--------+---------+
                            |                  |        |                  |
                            |   阿里云QWQ模型   |<-------+   图像生成服务    |
                            |                  |        |                  |
                            +------------------+        +--------+---------+
                                                                 |
                                                                 |
                                                                 v
                            +------------------+        +--------+---------+
                            |                  |        |                  |
                            | 阿里云通义万相API |<-------+   MongoDB数据库  |
                            |                  |        |                  |
                            +------------------+        +------------------+
```

## 图像生成流程图

```
+-------------+     +-------------+     +-------------+     +-------------+
|             |     |             |     |             |     |             |
| 用户输入提示词 +---->+ 前端发送请求 +---->+ 后端接收请求 +---->+ 验证请求参数 |
|             |     |             |     |             |     |             |
+-------------+     +-------------+     +-------------+     +------+------+
                                                                   |
                                                                   v
+-------------+     +-------------+     +-------------+     +------+------+
|             |     |             |     |             |     |             |
| 前端展示图像  <----+ 返回图像URL  <----+ 生成图像URL  <----+  优化提示词   |
|             |     |             |     |             |     |             |
+-------------+     +-------------+     +-------------+     +------+------+
                                                                   |
                                                                   v
                                                            +------+------+
                                                            |             |
                                                            | 调用图像生成API|
                                                            |             |
                                                            +-------------+
```

## 后端层次结构图

```
+-------------+
|             |
|   路由层     |
|             |
+------+------+
       |
       v
+------+------+
|             |
|   控制器层   |
|             |
+------+------+
       |
       v
+------+------+     +-------------+
|             |     |             |
|   服务层     +---->+   模型层     |
|             |     |             |
+------+------+     +-------------+
       |
       v
+------+------+
|             |
|   工具层     |
|             |
+-------------+
```

## 错误处理流程图

```
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|   服务层     +---->+   控制器层   +---->+ 错误处理中间件|
|  抛出错误    |     |  捕获错误    |     | 格式化错误   |
|             |     |             |     |             |
+-------------+     +-------------+     +------+------+
                                               |
                                               v
                                        +------+------+
                                        |             |
                                        |   客户端     |
                                        | 展示错误信息  |
                                        |             |
                                        +-------------+
```

## 部署架构图

```
                    +-------------+
                    |             |
                    |   用户浏览器  |
                    |             |
                    +------+------+
                           |
                           v
+-------------+     +------+------+
|             |     |             |
| 静态资源CDN  <-----+  前端应用    |
|             |     |             |
+-------------+     +------+------+
                           |
                           v
+-------------+     +------+------+     +-------------+
|             |     |             |     |             |
| 监控和告警   <-----+  后端API    +----->+  日志系统   |
|             |     |             |     |             |
+-------------+     +------+------+     +-------------+
                           |
                           v
                    +------+------+
                    |             |
                    | MongoDB数据库|
                    |             |
                    +-------------+
```

## 数据模型关系图

```
+-------------+                  +-------------+
|             |                  |             |
|    User     |                  |    Image    |
|             |                  |             |
+-------------+                  +-------------+
| id          |                  | id          |
| username    |                  | userId      |
| email       |                  | prompt      |
| password    |                  | optimizedPrompt |
| role        |                  | imageUrls   |
| createdAt   |                  | boardName   |
| updatedAt   |                  | metadata    |
+-------------+                  | createdAt   |
       |                         | updatedAt   |
       |                         +-------------+
       |                                |
       +--------------------------------+
                    1:N
```

## 技术栈图

```
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|    React    |     |  TypeScript |     | Tailwind CSS|
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
       |                  |                   |
       +------------------+-------------------+
                          |
                          v
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|   Node.js   |     |   Express   |     |  MongoDB    |
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
       |                  |                   |
       +------------------+-------------------+
                          |
                          v
+-------------+     +-------------+     +-------------+
|             |     |             |     |             |
|    Jest     |     |    Axios    |     |  OpenAI SDK |
|             |     |             |     |             |
+-------------+     +-------------+     +-------------+
```

注意：这些图表使用ASCII艺术表示，在实际文档中可以使用专业的图表工具（如Draw.io、Lucidchart等）创建更美观的图表。 